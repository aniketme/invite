<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Nidhi & Srijan ‚Äì Engagement Invitation</title>

  <!-- Social preview for WhatsApp / Twitter -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Nidhi Ray & Srijan Sinha ‚Äî Engagement Invitation"/>
  <meta property="og:description" content="Join us on 30th October, 5 PM onwards at Taj Taal Kutir, Royal Pavillion, New Town, Kolkata."/>
  <meta property="og:image" content="https://aniketme.github.io/invite/card.jpg"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <style>
    :root { --accent:#b3742a; --muted:#7a6b62; font-family:'Segoe UI','Helvetica Neue',Arial,sans-serif; }
    html,body{margin:0;height:100%;background:#fffaf6;overflow:auto;}
    .hidden{display:none}
    /* layout */
    #main{position:relative;z-index:50;width:100%;min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:32px 18px 72px;}
    .card{width:100%;max-width:820px;background:white;border-radius:14px;box-shadow:0 10px 36px rgba(0,0,0,.12);text-align:center;overflow:hidden;position:relative;}
    .hero img{width:100%;height:auto;display:block}
    .content{padding:22px}
    h1{color:var(--accent);font-size:26px;margin:6px 0}
    .meta{color:var(--muted);font-weight:500;margin-bottom:10px}

    /* glowing couple name */
    .couple {
      color:var(--accent);font-size:28px;font-weight:700;margin-top:10px;
      text-shadow:0 0 6px rgba(255,215,160,0.6),0 0 12px rgba(255,200,100,0.4),0 0 20px rgba(255,180,80,0.25);
      animation:glowPulse 2.6s ease-in-out infinite;
    }
    @keyframes glowPulse {
      0%,100% { text-shadow:0 0 6px rgba(255,215,160,0.6),0 0 12px rgba(255,200,100,0.4),0 0 20px rgba(255,180,80,0.25); }
      50% { text-shadow:0 0 14px rgba(255,230,180,0.95),0 0 28px rgba(255,200,120,0.7),0 0 48px rgba(255,180,90,0.45); }
    }

    /* map above countdown */
    .map-wrap { width:100%; text-align:center; margin:12px 0 8px; }
    .map-btn { display:inline-flex; align-items:center; gap:8px; padding:12px 22px; min-width:240px; max-width:90%; background:linear-gradient(180deg,#b3742a,#9a5f1f); color:#fff; border-radius:10px; text-decoration:none; font-weight:700; box-shadow:0 8px 28px rgba(163,110,49,0.18); transition:transform .18s; }
    .map-btn:hover { transform:translateY(-2px); }

    /* countdown below map center */
    .countdown { display:block; margin:16px auto; padding:14px; background:#f9f5f0; border-radius:10px; width:fit-content; animation:glow 2s infinite alternate; }
    @keyframes glow{from{box-shadow:0 0 6px rgba(179,116,42,.25)} to{box-shadow:0 0 18px rgba(179,116,42,.5)}}
    .time-grid{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}
    .time-cell{min-width:60px;padding:10px;border-radius:10px;background:white;box-shadow:0 4px 14px rgba(0,0,0,.06);color:var(--accent);font-weight:800}
    .label{font-size:11px;color:var(--muted);font-weight:600}

    footer{font-size:13px;color:var(--muted);padding:14px}

    /* petal layer on top of card */
    #petalLayer{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:22}
    .petal{
      position:absolute;
      width:18px;height:18px;
      background:radial-gradient(circle,#ffd1dc 0%,#ff8aa1 70%);
      border-radius:50% 50% 50% 50%/60% 60% 40% 40%;
      opacity:.85;will-change:transform,opacity;
      transform-origin:center;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.08));
    }

    /* music toggle */
    #musicBtn{position:fixed;bottom:16px;right:16px;z-index:999;background:var(--accent);color:white;border:none;width:48px;height:48px;border-radius:50%;font-size:20px;box-shadow:0 6px 20px rgba(0,0,0,.18);cursor:pointer}
    #musicBtn:hover{transform:scale(1.06)}

    /* confetti canvas */
    #confettiCanvas{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:2000;display:none}
    #celebrateMsg{position:fixed;left:50%;top:18%;transform:translateX(-50%);z-index:2100;background:rgba(255,255,255,0.96);padding:18px 22px;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.18);font-size:18px;color:var(--accent);display:none;text-align:center}

    @media(max-width:520px){
      .couple{font-size:20px}
      .map-btn{min-width:180px;padding:10px 14px}
      .time-cell{min-width:46px;padding:8px}
    }
  </style>
</head>
<body>
  <!-- MAIN (no overlay) -->
  <div id="main">
    <div class="card" id="card">
      <div id="petalLayer"></div>

      <div class="hero"><img src="card.jpg" alt="Engagement Invitation"></div>

      <div class="content">
        <div class="couple">üíç Nidhi Ray & Srijan Sinha üíç</div>
        <div class="meta">30th October 2025, 5:00 PM onwards<br>Taj Taal Kutir ‚Äî Royal Pavillion, New Town, Kolkata</div>

        <!-- Map (centered) -->
        <div class="map-wrap">
          <a class="map-btn" href="https://maps.app.goo.gl/UYmvdAzmmoXwgPUX6" target="_blank" rel="noopener">üìç Open in Google Maps</a>
        </div>

        <!-- Countdown (centered below map) -->
        <div class="countdown" id="countdownBox" aria-live="polite">
          <div class="time-grid">
            <div class="time-cell"><div id="days">--</div><div class="label">Days</div></div>
            <div class="time-cell"><div id="hours">--</div><div class="label">Hours</div></div>
            <div class="time-cell"><div id="minutes">--</div><div class="label">Minutes</div></div>
            <div class="time-cell"><div id="seconds">--</div><div class="label">Seconds</div></div>
          </div>
        </div>

        <!-- <footer>We can‚Äôt wait to celebrate with you üíñ</footer> -->
      </div>
    </div>
  </div>

  <!-- audio + controls -->
  <audio id="bgmusic" src="music.mp3" loop preload="auto"></audio>
  <button id="musicBtn" title="Toggle Music">üîä</button>

  <!-- confetti canvas & message -->
  <canvas id="confettiCanvas"></canvas>
  <div id="celebrateMsg">üéâ The celebration has begun! See you at the venue üéâ</div>

  <script>
  /***** COUNTDOWN *****/
  const eventDate = new Date(2025, 9, 30, 15, 0, 0);
  const daysEl = document.getElementById('days');
  const hoursEl = document.getElementById('hours');
  const minutesEl = document.getElementById('minutes');
  const secondsEl = document.getElementById('seconds');
  const countdownBox = document.getElementById('countdownBox');

  function updateCountdown(){
    const now = new Date();
    const diff = eventDate - now;
    if(diff <= 0){
      if(!window._celebrationTriggered){ triggerCelebration(); window._celebrationTriggered = true; }
      return;
    }
    const d = Math.floor(diff / (1000*60*60*24));
    const h = Math.floor((diff / (1000*60*60)) % 24);
    const m = Math.floor((diff / (1000*60)) % 60);
    const s = Math.floor((diff / 1000) % 60);
    daysEl.textContent = String(d).padStart(2,'0');
    hoursEl.textContent = String(h).padStart(2,'0');
    minutesEl.textContent = String(m).padStart(2,'0');
    secondsEl.textContent = String(s).padStart(2,'0');
  }
  updateCountdown();
  setInterval(updateCountdown, 1000);


  /***** AUDIO: fade in + auto-stop after 20s (keeps toggle) *****/
  const music = document.getElementById('bgmusic');
  const musicBtn = document.getElementById('musicBtn');
  let fadeTimer = null;
  let musicAutoStopTimer = null;
  let musicOn = false;

  music.volume = 0.03; // very low start

  // try autoplay
  music.play().then(()=> {
    fadeInAudio(0.4, 2000);
    scheduleAutoStop();
    musicOn = true; musicBtn.textContent = 'üîä';
  }).catch(()=>{/* will wait for interaction */});

  function fadeInAudio(targetVol = 0.4, duration = 2000) {
    clearInterval(fadeTimer);
    const steps = 40;
    const stepTime = duration / steps;
    const volInc = (targetVol - music.volume) / steps;
    let count = 0;
    fadeTimer = setInterval(()=> {
      music.volume = Math.min(targetVol, music.volume + volInc);
      if(++count >= steps) clearInterval(fadeTimer);
    }, stepTime);
  }
  function fadeOutAndPause(duration = 500) {
    clearInterval(fadeTimer);
    const steps = 25;
    const stepTime = duration / steps;
    const volDec = music.volume / steps;
    let count = 0;
    fadeTimer = setInterval(()=> {
      music.volume = Math.max(0, music.volume - volDec);
      if(++count >= steps) { clearInterval(fadeTimer); try{ music.pause(); }catch(e){} }
    }, stepTime);
  }

  function scheduleAutoStop() {
    clearTimeout(musicAutoStopTimer);
    musicAutoStopTimer = setTimeout(()=> {
      if(!music.paused) {
        fadeOutAndPause(900);
        musicOn = false; musicBtn.textContent = 'üîà';
      }
    }, 20000);
  }

  // start music on first interaction (mobile)
  function startMusicOnFirstInteraction(){
    music.play().then(()=> {
      fadeInAudio(0.4,2000);
      scheduleAutoStop();
      if('vibrate' in navigator) navigator.vibrate([60,30,60]);
      musicOn = true; musicBtn.textContent = 'üîä';
    }).catch(()=>{});
    document.removeEventListener('click', startMusicOnFirstInteraction);
    document.removeEventListener('touchstart', startMusicOnFirstInteraction);
  }
  document.addEventListener('click', startMusicOnFirstInteraction);
  document.addEventListener('touchstart', startMusicOnFirstInteraction, {passive:true});

  // manual toggle
  musicBtn.addEventListener('click', ()=> {
    if(music.paused){
      music.play().then(()=> { fadeInAudio(0.4,1500); scheduleAutoStop(); if('vibrate' in navigator) navigator.vibrate(30); musicOn = true; musicBtn.textContent='üîä'; }).catch(()=>{});
    } else {
      clearTimeout(musicAutoStopTimer);
      fadeOutAndPause(600); musicOn = false; musicBtn.textContent='üîà';
    }
  });


  /***** PETALS: downward slow fall with gentle sway, controlled spawn rate *****/
  const petalLayer = document.getElementById('petalLayer');
  let currentPetals = 0;
  const MAX_PETALS = 45;
  const AMBIENT_MIN_MS = 1000; // min spawn interval (1s)
  const AMBIENT_MAX_MS = 2000; // max spawn interval (2s)
  let ambientSpawnActive = false;
  let ambientSpawnTimer = null;

  function rand(min,max){ return min + Math.random()*(max-min); }

  function createPetalAt(x, y, opts = {}) {
    if(currentPetals >= MAX_PETALS) return null;
    const p = document.createElement('div');
    p.className = 'petal';
    const size = opts.size || rand(10,22);
    p.style.width = size + 'px';
    p.style.height = (size * 0.85) + 'px';
    p.style.left = (x - size/2) + 'px';
    p.style.top = (y - size/2) + 'px';
    p.style.opacity = (0.5 + Math.random()*0.45);

    // slow durations: 18 - 30 seconds (in ms)
    const dur = Math.floor(rand(18000,30000));
    // gentle horizontal sway drift
    const drift = rand(-140, 140); // px total drift across fall
    const rotateStart = rand(-40,40);
    const rotateEnd = rotateStart + rand(200,480);

    // append
    petalLayer.appendChild(p);
    currentPetals++;

    // animate using WAAPI for smoothness
    p.animate([
      { transform: `rotate(${rotateStart}deg) translateX(0px) translateY(0px)`, opacity: 1 },
      // mid point slightly to left or right for sway
      { offset: 0.5, transform: `rotate(${(rotateStart + rotateEnd)/2}deg) translateX(${drift*0.45}px) translateY(${window.innerHeight*0.45}px)`, opacity: 0.95 },
      // final near bottom (translateY relative to card height + some)
      { transform: `rotate(${rotateEnd}deg) translateX(${drift}px) translateY(${Math.max(window.innerHeight, 800)}px)`, opacity: 0 }
    ], {
      duration: dur,
      easing: 'cubic-bezier(.2,.8,.2,1)',
      iterations: 1,
      fill: 'forwards'
    });

    // cleanup after animation
    setTimeout(()=> {
      try{ p.remove(); currentPetals = Math.max(0, currentPetals-1); } catch(e){}
    }, dur + 700);

    return p;
  }

  function spawnAmbientOnce(){
    if(!petalLayer) return;
    if(currentPetals >= MAX_PETALS) {
      // schedule next check a bit later to avoid starving
      ambientSpawnTimer = setTimeout(spawnAmbientOnce, rand(800,1400));
      return;
    }
    try {
      const rect = petalLayer.getBoundingClientRect();
      // spawn from random x across top area, y slightly above visible area
      const x = rand(8, rect.width - 8);
      const y = rand(-40, -8); // start above card
      createPetalAt(x, y);
    } catch(e){}
    const next = Math.floor(rand(AMBIENT_MIN_MS, AMBIENT_MAX_MS));
    ambientSpawnTimer = setTimeout(spawnAmbientOnce, next);
  }

  function spawnAmbientPetalsStart(){
    if(ambientSpawnActive) return;
    ambientSpawnActive = true;
    spawnAmbientOnce();
  }
  function stopAmbientPetals(){
    clearTimeout(ambientSpawnTimer);
    ambientSpawnActive = false;
  }

  // user burst
  function burstPetalsAt(pageX, pageY){
    if('vibrate' in navigator) navigator.vibrate(20);
    const rect = petalLayer.getBoundingClientRect();
    const x = pageX - rect.left;
    const y = pageY - rect.top;
    // create 8-12 petals but respect MAX_PETALS
    const count = Math.min(12, Math.max(6, Math.floor(rand(8,12))));
    for(let i=0;i<count;i++){
      const rx = x + rand(-60,60);
      const ry = y + rand(-30,30);
      createPetalAt(rx, ry, { size: rand(8,20) });
    }
  }

  // attach handlers
  const card = document.getElementById('card');
  card.addEventListener('click', (ev)=>{
    if(ev.target.closest('a')) return;
    burstPetalsAt(ev.pageX, ev.pageY);
  });
  card.addEventListener('touchstart', (ev)=>{
    if(ev.target.closest('a')) return;
    const t = ev.touches[0];
    burstPetalsAt(t.pageX, t.pageY);
  }, {passive:true});

  // start ambient on load
  window.addEventListener('load', ()=> {
    document.getElementById('main').style.opacity = '1';
    spawnAmbientPetalsStart();
    // if already past event, trigger celebration
    if(new Date() >= eventDate) triggerCelebration();
  });


  /***** CONFETTI RAIN CELEBRATION (no fireworks) *****/
  const confettiCanvas = document.getElementById('confettiCanvas');
  const celebrateMsg = document.getElementById('celebrateMsg');

  function triggerCelebration(){
    if(window._celebrationRunning) return;
    window._celebrationRunning = true;
    celebrateMsg.style.display = 'block';
    confettiCanvas.style.display = 'block';
    const ctx = confettiCanvas.getContext('2d');
    confettiCanvas.width = window.innerWidth * devicePixelRatio;
    confettiCanvas.height = window.innerHeight * devicePixelRatio;
    confettiCanvas.style.width = window.innerWidth + 'px';
    confettiCanvas.style.height = window.innerHeight + 'px';
    ctx.scale(devicePixelRatio, devicePixelRatio);

    const colors = ['#ff4d6d','#ffd166','#90e0ef','#d5f7e3','#ffd6a5','#b3742a'];
    const particles = [];
    const num = Math.min(280, Math.floor(window.innerWidth/3));
    for(let i=0;i<num;i++){
      particles.push({
        x: Math.random()*window.innerWidth,
        y: -20 - Math.random()*400,
        vx: (Math.random()-0.5)*8,
        vy: (2 + Math.random()*6),
        size: 6 + Math.random()*10,
        angle: Math.random()*360,
        angularVel: (Math.random()-0.5)*0.2,
        color: colors[Math.floor(Math.random()*colors.length)],
        ttl: 400 + Math.random()*400
      });
    }
    let last = performance.now();
    function frame(now){
      const dt = now - last; last = now;
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
      for(let i=0;i<particles.length;i++){
        const p = particles[i];
        p.vy += 0.04 * (dt/16);
        p.x += p.vx * (dt/16);
        p.y += p.vy * (dt/16);
        p.angle += p.angularVel * (dt/16);
        p.ttl -= dt;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.angle * Math.PI/180);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
        ctx.restore();
      }
      const alive = particles.filter(p => p.ttl > 0 && p.y < window.innerHeight + 100);
      if(alive.length > 0) requestAnimationFrame(frame);
      else {
        setTimeout(()=> {
          ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
          confettiCanvas.style.display = 'none';
          celebrateMsg.style.display = 'none';
          window._celebrationRunning = false;
        }, 1200);
      }
    }
    requestAnimationFrame(frame);
    if('vibrate' in navigator) navigator.vibrate([100,50,120]);
    let pulses = 0;
    const pulseI = setInterval(()=> {
      countdownBox.style.transform = 'scale(1.03)';
      setTimeout(()=> countdownBox.style.transform='scale(1)', 300);
      pulses++; if(pulses>6){ clearInterval(pulseI); countdownBox.style.transform=''; }
    }, 500);
  }

  // responsive: resize confetti canvas if visible
  window.addEventListener('resize', ()=> {
    if(confettiCanvas.style.display !== 'none'){
      confettiCanvas.width = window.innerWidth * devicePixelRatio;
      confettiCanvas.height = window.innerHeight * devicePixelRatio;
      confettiCanvas.style.width = window.innerWidth + 'px';
      confettiCanvas.style.height = window.innerHeight + 'px';
      confettiCanvas.getContext('2d').scale(devicePixelRatio, devicePixelRatio);
    }
  });

  </script>
</body>
</html>
